(function(){"use strict";const r={SITE_CUSTOMIZATIONS:"siteCustomizations",SETTINGS:"settings"},h=1e4;console.log("[v0] Content script loaded");let y=!1;chrome.runtime.onMessage.addListener((e,n,t)=>(e.type==="TOGGLE_ZEN_MODE"&&(b(e.payload?.preset),t({success:!0})),!0));const T=async()=>{if(!y){y=!0;try{const e=document.body?.innerText?.slice(0,h)??"",n=window.location.href,t=await v(e,n);chrome.runtime.sendMessage({type:"CONTENT_ANALYSIS_RESULT",payload:t}),console.log("[v0] Content analyzed:",t.classification)}catch(e){console.error("[v0] Error analyzing content:",e)}}};document.readyState==="complete"||document.readyState==="interactive"?T():document.addEventListener("DOMContentLoaded",T,{once:!0});async function v(e,n){const{[r.SETTINGS]:t}=await chrome.storage.sync.get(r.SETTINGS),s=t?.productiveKeywords||[],d=t?.distractingKeywords||[],p=e.toLowerCase();let l=0,u=0;const E=o=>o.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");s.forEach(o=>{const f=new RegExp(`\\b${E(o)}\\b`,"gi"),c=p.match(f);c&&(l+=c.length)}),d.forEach(o=>{const f=new RegExp(`\\b${E(o)}\\b`,"gi"),c=p.match(f);c&&(u+=c.length)});const M=l+u,m=M>0?u/M:0;let g="neutral";return m>.6?g="distracting":m<.4&&l>0&&(g="productive"),{url:n,classification:g,score:m,timestamp:Date.now()}}let a=!1,i=null,S="";function b(e){a?(i!==null&&(document.body.innerHTML=i,document.body.style.background=S,i=null),a=!1,console.log("[v0] Zen Mode deactivated")):(i=document.body.innerHTML,S=document.body.style.background,x(e),a=!0,console.log("[v0] Zen Mode activated"))}function x(e){const n=C();e&&L(e);const t=document.createElement("div");t.id="zen-mode-container",t.style.cssText=`
    max-width: 800px;
    margin: 0 auto;
    padding: 40px 20px;
    font-family: Georgia, serif;
    font-size: 18px;
    line-height: 1.6;
    color: #333;
    background: #fff;
  `,t.innerHTML=n,document.body.innerHTML="",document.body.appendChild(t),document.body.style.background="#f5f5f5"}function C(){const e=document.querySelector("article"),n=document.querySelector("main"),t=document.querySelector('[role="main"]');return e?e.innerHTML:n?n.innerHTML:t?t.innerHTML:document.body.innerHTML}async function L(e){const{[r.SITE_CUSTOMIZATIONS]:n}=await chrome.storage.local.get(r.SITE_CUSTOMIZATIONS),t=n?.[e];t?.selectorsToRemove&&t.selectorsToRemove.forEach(s=>{document.querySelectorAll(s).forEach(d=>d.remove())})}})();
