(function(){"use strict";console.log("[v0] Content script loaded"),chrome.runtime.onMessage.addListener((t,n,e)=>{var o;return t.type==="TOGGLE_ZEN_MODE"&&(h((o=t.payload)==null?void 0:o.preset),e({success:!0})),!0}),document.addEventListener("DOMContentLoaded",async()=>{await y()}),(document.readyState==="complete"||document.readyState==="interactive")&&y();async function y(){try{const t=document.body.innerText.slice(0,1e4),n=window.location.href,e=await p(t,n);chrome.runtime.sendMessage({type:"CONTENT_ANALYSIS_RESULT",payload:e}),console.log("[v0] Content analyzed:",e.classification)}catch(t){console.error("[v0] Error analyzing content:",t)}}async function p(t,n){const{settings:e}=await chrome.storage.sync.get("settings"),o=(e==null?void 0:e.productiveKeywords)||[],a=(e==null?void 0:e.distractingKeywords)||[],g=t.toLowerCase();let s=0,d=0;o.forEach(f=>{const m=new RegExp(`\\b${f}\\b`,"gi"),c=g.match(m);c&&(s+=c.length)}),a.forEach(f=>{const m=new RegExp(`\\b${f}\\b`,"gi"),c=g.match(m);c&&(d+=c.length)});const T=s+d,l=T>0?d/T:0;let u="neutral";return l>.6?u="distracting":l<.4&&s>0&&(u="productive"),{url:n,classification:u,score:l,timestamp:Date.now()}}let i=!1,r=null;function h(t){i?(r&&(document.body.innerHTML=r,r=null),i=!1,console.log("[v0] Zen Mode deactivated")):(r=document.body.innerHTML,M(t),i=!0,console.log("[v0] Zen Mode activated"))}function M(t){const n=v();t&&E(t);const e=document.createElement("div");e.id="zen-mode-container",e.style.cssText=`
    max-width: 800px;
    margin: 0 auto;
    padding: 40px 20px;
    font-family: Georgia, serif;
    font-size: 18px;
    line-height: 1.6;
    color: #333;
    background: #fff;
  `,e.innerHTML=n,document.body.innerHTML="",document.body.appendChild(e),document.body.style.background="#f5f5f5"}function v(){const t=document.querySelector("article"),n=document.querySelector("main"),e=document.querySelector('[role="main"]');return t?t.innerHTML:n?n.innerHTML:e?e.innerHTML:document.body.innerHTML}async function E(t){const{zenModePresets:n}=await chrome.storage.local.get("zenModePresets"),e=n==null?void 0:n.find(o=>o.domain===t);e!=null&&e.selectorsToRemove&&e.selectorsToRemove.forEach(o=>{document.querySelectorAll(o).forEach(a=>a.remove())})}})();
