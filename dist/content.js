(function(){"use strict";const a={SITE_CUSTOMIZATIONS:"siteCustomizations",SETTINGS:"settings"},h=1e4;console.log("[v0] Content script loaded");let g=!1;chrome.runtime.onMessage.addListener((t,n,e)=>{var o;return t.type==="TOGGLE_ZEN_MODE"&&(b((o=t.payload)==null?void 0:o.preset),e({success:!0})),!0});const T=async()=>{if(!g){g=!0;try{const t=document.body.innerText.slice(0,h),n=window.location.href,e=await v(t,n);chrome.runtime.sendMessage({type:"CONTENT_ANALYSIS_RESULT",payload:e}),console.log("[v0] Content analyzed:",e.classification)}catch(t){console.error("[v0] Error analyzing content:",t)}}};document.readyState==="complete"||document.readyState==="interactive"?T():document.addEventListener("DOMContentLoaded",T);async function v(t,n){const{[a.SETTINGS]:e}=await chrome.storage.sync.get(a.SETTINGS),o=(e==null?void 0:e.productiveKeywords)||[],d=(e==null?void 0:e.distractingKeywords)||[],p=t.toLowerCase();let l=0,u=0;const E=c=>c.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");o.forEach(c=>{const y=new RegExp(`\\b${E(c)}\\b`,"gi"),r=p.match(y);r&&(l+=r.length)}),d.forEach(c=>{const y=new RegExp(`\\b${E(c)}\\b`,"gi"),r=p.match(y);r&&(u+=r.length)});const M=l+u,m=M>0?u/M:0;let f="neutral";return m>.6?f="distracting":m<.4&&l>0&&(f="productive"),{url:n,classification:f,score:m,timestamp:Date.now()}}let s=!1,i=null,S="";function b(t){s?(i&&(document.body.innerHTML=i,document.body.style.background=S,i=null),s=!1,console.log("[v0] Zen Mode deactivated")):(i=document.body.innerHTML,S=document.body.style.background,x(t),s=!0,console.log("[v0] Zen Mode activated"))}function x(t){const n=L();t&&w(t);const e=document.createElement("div");e.id="zen-mode-container",e.style.cssText=`
    max-width: 800px;
    margin: 0 auto;
    padding: 40px 20px;
    font-family: Georgia, serif;
    font-size: 18px;
    line-height: 1.6;
    color: #333;
    background: #fff;
  `,e.innerHTML=n,document.body.innerHTML="",document.body.appendChild(e),document.body.style.background="#f5f5f5"}function L(){const t=document.querySelector("article"),n=document.querySelector("main"),e=document.querySelector('[role="main"]');return t?t.innerHTML:n?n.innerHTML:e?e.innerHTML:document.body.innerHTML}async function w(t){const{[a.SITE_CUSTOMIZATIONS]:n}=await chrome.storage.local.get(a.SITE_CUSTOMIZATIONS),e=n==null?void 0:n[t];e!=null&&e.selectorsToRemove&&e.selectorsToRemove.forEach(o=>{document.querySelectorAll(o).forEach(d=>d.remove())})}})();
